<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>GMT | DASHBOARD ESTRATÉGICO</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        
        /* Contenedor Principal de la Imagen */
        .kpi-main-container {
            background: white;
            border-radius: 2.5rem;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        /* Bloques Superiores */
        .bg-ventas-brutas { background-color: #1a2e5a; } /* Azul oscuro */
        .bg-meta-movistar { background-color: #00965e; } /* Verde Movistar */
        .bg-meta-gmt { background-color: #c45511; }      /* Naranja/Marrón GMT */

        .big-number { font-weight: 900; font-style: italic; line-height: 0.9; }
        .label-top { font-size: 0.65rem; font-weight: 900; text-transform: uppercase; letter-spacing: 0.15em; opacity: 0.8; }
        
        /* Punto decorativo de las metas */
        .dot { height: 8px; width: 8px; background-color: #ff8fa3; border-radius: 50%; display: inline-block; margin-right: 8px; }

        .filter-select {
            background: white; border-radius: 0.75rem; padding: 0.5rem 1rem;
            font-weight: 800; text-transform: uppercase; font-size: 0.7rem; border: 1px solid #e2e8f0;
        }
    </style>
</head>
<body class="p-6 md:p-12">

    <div class="max-w-6xl mx-auto">
        
        <div class="flex justify-end gap-2 mb-6">
            <select id="month_filter" onchange="updateDayFilter()" class="filter-select"></select>
            <select id="day_filter" onchange="render()" class="filter-select"></select>
        </div>

        <div class="kpi-main-container">
            <div class="grid grid-cols-1 md:grid-cols-3 text-white">
                
                <div class="bg-ventas-brutas p-10 text-center">
                    <p class="label-top mb-4">Ventas Brutas</p>
                    <h2 id="val_ventas" class="big-number text-7xl italic">0</h2>
                    <p id="val_ritmo" class="text-[10px] font-bold mt-4 opacity-60">RITMO: 0 / DÍA</p>
                </div>

                <div class="bg-meta-movistar p-10 text-center relative border-x border-white/10">
                    <p class="label-top mb-4">Meta Movistar (509)</p>
                    <div class="flex items-center justify-center">
                        <span class="dot"></span>
                        <h2 id="val_meta_mov_perc" class="big-number text-7xl italic">0%</h2>
                    </div>
                    <h3 id="val_meta_mov_abs" class="text-3xl font-black mt-2">-0</h3>
                </div>

                <div class="bg-meta-gmt p-10 text-center">
                    <p class="label-top mb-4">Meta GMT (604)</p>
                    <div class="flex items-center justify-center">
                        <span class="dot" style="background-color: #fca5a5; opacity: 0.6;"></span>
                        <h2 id="val_meta_gmt_perc" class="big-number text-7xl italic">0%</h2>
                    </div>
                    <h3 id="val_meta_gmt_abs" class="text-3xl font-black mt-2">-0</h3>
                </div>

            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 py-10 px-6 gap-4 bg-white border-t border-slate-50">
                
                <div class="text-center border-r border-slate-100 last:border-0">
                    <p class="text-[10px] font-black text-blue-600 uppercase mb-2">Activación (Altas)</p>
                    <p class="text-5xl font-black text-slate-800 italic inline-block">
                        <span id="val_alta">0</span>%
                    </p>
                    <span id="val_alta_ud" class="text-[10px] font-bold text-slate-400 ml-1">0 ud</span>
                </div>

                <div class="text-center border-r border-slate-100 last:border-0">
                    <p class="text-[10px] font-black text-orange-500 uppercase mb-2">Tráfico Real</p>
                    <p class="text-5xl font-black text-slate-800 italic inline-block">
                        <span id="val_traf">0</span>%
                    </p>
                    <span id="val_traf_ud" class="text-[10px] font-bold text-slate-400 ml-1">0 ud</span>
                </div>

                <div class="text-center border-r border-slate-100 last:border-0">
                    <p class="text-[10px] font-black text-blue-400 uppercase mb-2">Promedio ARPU</p>
                    <p class="text-5xl font-black text-slate-800 italic">$<span id="val_arpu">0</span></p>
                </div>

                <div class="text-center">
                    <p class="text-[10px] font-black text-emerald-500 uppercase mb-2">Enrolamiento</p>
                    <p class="text-5xl font-black text-slate-800 italic"><span id="val_enro">0</span>%</p>
                </div>

            </div>
        </div>

    </div>

    <script>
        let globalRawData = [];
        const GITHUB_URL = "https://raw.githubusercontent.com/gmt-gestion01/monitor-ventas/main/ventas.csv";

        async function autoLoadCSV() {
            try {
                const res = await fetch(`${GITHUB_URL}?v=${Date.now()}`);
                const text = await res.text();
                const lines = text.split(/\r?\n/).filter(l => l.trim() !== "");
                const sep = lines[0].includes(';') ? ';' : ',';
                
                globalRawData = lines.slice(1).map(line => {
                    const c = line.split(sep).map(x => x.replace(/['"]+/g, '').trim());
                    if(!c[1]) return null;
                    return {
                        fVenta: c[1],
                        esAlta: c[3] && c[3].toUpperCase() !== "SIN ALTA" && c[3].toUpperCase() !== "NO",
                        arpu: parseFloat(c[5]) || 0,
                        esTrafico: c[6] && (c[6].toUpperCase().includes("TRAFICO") || c[6].toUpperCase() === "SI"),
                        esEnrolado: c[8] && (c[8].toUpperCase().includes("ENROLADO") || c[8].toUpperCase() === "SI"),
                        mes: (c[9] || "FEBRERO").toLowerCase()
                    };
                }).filter(d => d !== null);

                const meses = [...new Set(globalRawData.map(d => d.mes))].sort();
                document.getElementById('month_filter').innerHTML = meses.map(m => `<option value="${m}">${m.toUpperCase()}</option>`).join('');
                updateDayFilter();
            } catch (err) { console.error(err); }
        }

        function updateDayFilter() {
            const selMes = document.getElementById('month_filter').value;
            const days = [...new Set(globalRawData.filter(d => d.mes === selMes).map(d => d.fVenta))].sort();
            document.getElementById('day_filter').innerHTML = '<option value="ALL">TODOS LOS DÍAS</option>' + days.map(d => `<option value="${d}">${d}</option>`).join('');
            render();
        }

        function render() {
            const selMes = document.getElementById('month_filter').value;
            const selDia = document.getElementById('day_filter').value;
            let data = globalRawData.filter(d => d.mes === selMes);
            if(selDia !== "ALL") data = data.filter(d => d.fVenta === selDia);

            const total = data.length;
            const altas = data.filter(x => x.esAlta).length;
            const trafico = data.filter(x => x.esTrafico).length;
            const enrolado = data.filter(x => x.esEnrolado).length;
            const sumArpu = data.reduce((acc, curr) => acc + curr.arpu, 0);
            
            // Fila Superior
            document.getElementById('val_ventas').innerText = total;
            const diasActivos = [...new Set(data.map(d => d.fVenta))].length || 1;
            document.getElementById('val_ritmo').innerText = `RITMO: ${Math.round(total/diasActivos)} / DÍA`;
            
            // Metas (Valores de la imagen)
            const metaMov = 509; const metaGmt = 604;
            document.getElementById('val_meta_mov_perc').innerText = Math.round((total/metaMov)*100) + "%";
            document.getElementById('val_meta_mov_abs').innerText = (total - metaMov);
            document.getElementById('val_meta_gmt_perc').innerText = Math.round((total/metaGmt)*100) + "%";
            document.getElementById('val_meta_gmt_abs').innerText = (total - metaGmt);

            // Fila Inferior
            document.getElementById('val_alta').innerText = Math.round((altas/total)*100)||0;
            document.getElementById('val_alta_ud').innerText = `${altas} ud`;
            document.getElementById('val_traf').innerText = Math.round((trafico/total)*100)||0;
            document.getElementById('val_traf_ud').innerText = `${trafico} ud`;
            document.getElementById('val_arpu').innerText = Math.round(sumArpu/total)||0;
            document.getElementById('val_enro').innerText = Math.round((enrolado/total)*100)||0;
        }

        window.onload = autoLoadCSV;
    </script>
</body>
</html>
