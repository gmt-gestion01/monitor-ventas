<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>GMT | MONITOR ESTRAT√âGICO</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #334155; }
        .bg-main-dark { background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); }
        .bg-movistar { background: linear-gradient(135deg, #065f46 0%, #10b981 100%); }
        .bg-gmt { background: linear-gradient(135deg, #9a3412 0%, #f97316 100%); }
        .glass-card { background: #ffffff; border: 1px solid #e2e8f0; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05); }
        .stat-label { font-size: 0.65rem; font-weight: 900; text-transform: uppercase; letter-spacing: 0.05em; color: #94a3b8; }
        .flag-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; border: 2px solid rgba(255,255,255,0.2); }
        .sup-card { transition: all 0.2s; border: 1px solid #e2e8f0; border-radius: 2rem; background: white; }
    </style>
</head>
<body class="p-4 md:p-8">

    <nav style="background: #0f172a; padding: 12px; display: flex; justify-content: center; gap: 15px; border-bottom: 3px solid #1e293b; font-family: sans-serif; margin: -1rem -1rem 2rem -1rem;">
        <a href="index.html" style="text-decoration: none; font-size: 11px; font-weight: 900; padding: 10px 20px; border-radius: 8px; background: #1e293b; color: #94a3b8; border: 1px solid #334155;">
            üìä DASHBOARD HORAS
        </a>
        <a href="ventas.html" style="text-decoration: none; font-size: 11px; font-weight: 900; padding: 10px 20px; border-radius: 8px; background: #10b981; color: white; border: 1px solid #34d399; box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);">
            üí∞ DASHBOARD VENTAS
        </a>
    </nav>

    <div id="dashboard-content" class="max-w-7xl mx-auto">
        <header class="flex flex-col lg:flex-row justify-between items-center gap-6 mb-10">
            <div class="text-center lg:text-left">
                <h1 class="text-6xl font-black tracking-tighter uppercase italic py-2">
                    <span style="background: linear-gradient(180deg, #ff9d42 0%, #ff6b00 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 1px 1px 0px #b45309;">GMT</span>
                    <span style="background: linear-gradient(180deg, #58a5ff 0%, #0056ce 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 1px 1px 0px #1e40af;">PREPAGO</span>
                </h1>
                <p class="text-slate-400 font-bold text-[11px] uppercase tracking-[0.45em]">An√°lisis de Eficiencia | 2026</p>
            </div>
            <div id="status-update" class="text-[10px] font-bold text-emerald-500 bg-emerald-50 px-4 py-2 rounded-full uppercase tracking-widest italic">
                ‚óè Datos Sincronizados
            </div>
        </header>

        <div class="glass-card rounded-[3rem] overflow-hidden mb-8 shadow-xl">
            <div class="grid grid-cols-1 md:grid-cols-3 text-white text-center">
                <div class="bg-main-dark p-10 md:border-r border-white/10">
                    <p class="text-[10px] font-black uppercase tracking-[0.2em] text-blue-200 mb-2">Ventas Brutas</p>
                    <h2 id="k_bruto" class="text-7xl font-black italic leading-none">0</h2>
                    <span id="k_ritmo" class="text-[11px] font-bold text-blue-300/80 uppercase tracking-tighter">Ritmo: 0 / d√≠a</span>
                </div>
                <div class="bg-movistar p-10 md:border-r border-white/10">
                    <p class="text-[10px] font-black uppercase tracking-[0.2em] text-emerald-100 mb-2">Meta Movistar (509)</p>
                    <div class="flex flex-col items-center">
                        <div class="flex items-center mb-1">
                            <span id="flag_509" class="flag-dot bg-slate-400"></span>
                            <h2 id="k_cumplimiento_509" class="text-6xl font-black italic">0%</h2>
                        </div>
                        <span id="k_gap_509" class="text-3xl font-black text-white/90">0</span>
                    </div>
                </div>
                <div class="bg-gmt p-10">
                    <p class="text-[10px] font-black uppercase tracking-[0.2em] text-orange-100 mb-2">Meta GMT (604)</p>
                    <div class="flex flex-col items-center">
                        <div class="flex items-center mb-1">
                            <span id="flag_604" class="flag-dot bg-slate-400"></span>
                            <h2 id="k_cumplimiento_604" class="text-6xl font-black italic">0%</h2>
                        </div>
                        <span id="k_gap_604" class="text-3xl font-black text-white/90">0</span>
                    </div>
                </div>
            </div>
            <div class="p-10 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8 text-center bg-white">
                <div><p class="stat-label text-blue-600 mb-2">Activaci√≥n</p><span id="alta_rel" class="text-5xl font-black text-slate-800">0%</span></div>
                <div><p class="stat-label text-orange-500 mb-2">Tr√°fico Real</p><span id="trafico_rel" class="text-5xl font-black text-slate-800">0%</span></div>
                <div><p class="stat-label text-blue-400 mb-2">Promedio ARPU</p><span id="k_arpu" class="text-5xl font-black text-slate-800">$0</span></div>
                <div><p class="stat-label text-emerald-500 mb-2 italic">Enrolamiento</p><span id="enrol_rel_main" class="text-5xl font-black text-slate-800">0%</span></div>
            </div>
        </div>

        <div class="glass-card p-8 rounded-[2.5rem] mb-8"><div id="g_tendencia" style="height: 400px; width: 100%;"></div></div>
        <div id="supervisor_grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-20"></div>
    </div>

    <script>
        window.onload = () => {
            loadDataAutomatic();
        };

        async function loadDataAutomatic() {
            try {
                const response = await fetch('data.csv'); 
                if (!response.ok) throw new Error("No se encontr√≥ data.csv");
                const csvText = await response.text();
                processCSV(csvText);
            } catch (err) {
                console.error("Error al cargar datos:", err);
            }
        }

        function processCSV(text) {
            const lines = text.split(/\r?\n/).filter(l => l.trim() !== "");
            const sep = lines[0].includes(';') ? ';' : ',';
            const globalData = lines.slice(1).map(line => {
                const c = line.split(sep).map(x => x.replace(/['"]+/g, '').trim());
                if (!c[0]) return null;
                let m = 0; if(c[7] && c[7].toUpperCase() !== "SIN RECARGA") m = parseFloat(c[7].replace(/[^0-9.]/g, '')) || 0;
                const valAlta = c[3] ? c[3].toUpperCase() : "";
                const esAlta = valAlta !== "" && valAlta !== "SIN ALTA" && valAlta !== "NO";
                const valTraf = c[6] ? c[6].toUpperCase() : "";
                const esTrafico = valTraf === "SI" || valTraf === "CON TRAFICO" || valTraf === "TRAFICO";
                const valEnrol = c[8] ? c[8].toUpperCase() : "";
                const esEnrolado = valEnrol === "SI" || valEnrol === "ENROLADO";
                return { dn: c[0], fVenta: c[1], supervisor: c[2] || "S/S", esAlta, esTrafico, esEnrolado, recargaVal: m };
            }).filter(d => d !== null);
            render(globalData);
        }

        function setStatus(total, metaUnit, dias, idFlag, idCumple, idGap) {
            const obj = (dias || 1) * metaUnit;
            const cumple = Math.round((total / obj) * 100) || 0;
            const gap = total - obj;
            document.getElementById(idCumple).innerText = cumple + "%";
            document.getElementById(idGap).innerText = (gap >= 0 ? "+" : "") + gap;
            document.getElementById(idFlag).style.backgroundColor = cumple >= 98 ? '#4ade80' : cumple < 89 ? '#f87171' : '#fbbf24';
        }

        function render(globalData) {
            const total = globalData.length;
            const dates = [...new Set(globalData.map(d => d.fVenta))].sort();
            const dias = dates.length || 1;
            const counts = dates.map(dt => globalData.filter(d => d.fVenta === dt).length);

            document.getElementById('k_bruto').innerText = total;
            document.getElementById('k_ritmo').innerText = `Ritmo: ${Math.round(total/dias)} / d√≠a`;
            setStatus(total, 509, dias, 'flag_509', 'k_cumplimiento_509', 'k_gap_509');
            setStatus(total, 604, dias, 'flag_604', 'k_cumplimiento_604', 'k_gap_604');
            
            document.getElementById('alta_rel').innerText = (total > 0 ? Math.round((globalData.filter(d => d.esAlta).length / total) * 100) : 0) + "%";
            document.getElementById('trafico_rel').innerText = (total > 0 ? Math.round((globalData.filter(d => d.esTrafico).length / total) * 100) : 0) + "%";
            
            const recs = globalData.filter(d => d.recargaVal > 0);
            document.getElementById('k_arpu').innerText = "$" + (recs.length > 0 ? Math.round(recs.reduce((s, d) => s + d.recargaVal, 0) / recs.length) : 0);
            document.getElementById('enrol_rel_main').innerText = (total > 0 ? Math.round((globalData.filter(d => d.esEnrolado).length / total) * 100) : 0) + "%";

            Plotly.newPlot('g_tendencia', [
                { x: dates, y: counts, name: 'Reales', type: 'scatter', mode: 'lines+markers', line: {color: '#1e3a8a', width: 3} }
            ], { paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', height: 400 });

            const supers = [...new Set(globalData.map(d => d.supervisor))].sort();
            document.getElementById('supervisor_grid').innerHTML = supers.map(s => {
                const dSup = globalData.filter(x => x.supervisor === s);
                const v = dSup.length;
                return `
                    <div class="sup-card p-6">
                        <p class="text-[11px] font-black text-blue-900 border-b pb-2 mb-4 uppercase italic tracking-tighter">${s}</p>
                        <p class="text-3xl font-black text-slate-800 text-center">${v}</p>
                        <div class="grid grid-cols-3 gap-2 mt-4">
                            <div class="bg-blue-50 p-2 rounded-xl text-center"><p class="stat-label text-[6px]">Alta</p><p class="text-[11px] font-black">${Math.round((dSup.filter(x=>x.esAlta).length/v)*100)||0}%</p></div>
                            <div class="bg-orange-50 p-2 rounded-xl text-center"><p class="stat-label text-[6px]">Traf</p><p class="text-[11px] font-black">${Math.round((dSup.filter(x=>x.esTrafico).length/v)*100)||0}%</p></div>
                            <div class="bg-emerald-50 p-2 rounded-xl text-center"><p class="stat-label text-[6px]">Enrol</p><p class="text-[11px] font-black">${Math.round((dSup.filter(x=>x.esEnrolado).length/v)*100)||0}%</p></div>
                        </div>
                    </div>`;
            }).join('');
        }
    </script>
</body>
</html>
